<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>自由的灵魂</title>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.9.min.js"></script>
    <style>
        body { background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%); color: #ffffff; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: sans-serif; overflow: hidden; position: relative; }
        .night { position: absolute; width: 100%; height: 100%; transform: rotateZ(45deg); pointer-events: none; }
        .shooting_star { position: absolute; left: 50%; top: 50%; height: 2px; background: linear-gradient(-45deg, #5f91ff, rgba(0,0,255,0)); border-radius: 999px; animation: tail 3s ease-in-out infinite, shooting 3s ease-in-out infinite; }
        @keyframes tail { 0% { width: 0; } 30% { width: 100px; } 100% { width: 0; } }
        @keyframes shooting { 0% { transform: translateX(0); } 100% { transform: translateX(300px); } }
        .shooting_star:nth-child(1) { top: 10%; left: 30%; } .shooting_star:nth-child(2) { top: 30%; left: 60%; animation-delay: 1.2s; }
        h1 { font-weight: 200; letter-spacing: 4px; z-index: 10; font-size: 1.5rem; text-align: center; }
        .enter-btn { padding: 12px 30px; background: transparent; border: 1px solid white; color: white; cursor: pointer; z-index: 10; border-radius: 4px; }
        #chat-container { display: none; flex-direction: column; width: 92%; max-width: 500px; z-index: 20; height: 75vh; }
        #chat-box { width: 100%; flex: 1; background: rgba(255,255,255,0.1); overflow-y: auto; padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); margin-bottom: 10px; backdrop-filter: blur(10px); box-sizing: border-box; -webkit-overflow-scrolling: touch; }
        #input-area { width: 100%; display: flex; gap: 8px; }
        #msg-input { flex: 1; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 8px; font-size: 16px; outline: none; }
        .btn { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #send-btn { background: white; color: black; }
        #exit-btn { background: rgba(255,255,255,0.1); color: #ccc; }
        .footer-text { position: absolute; bottom: 20px; color: #666; font-size: 0.7rem; }
    </style>
</head>
<body>
    <div class="night"><div class="shooting_star"></div><div class="shooting_star"></div></div>
    <h1 id="title">这里欢迎每一个渴望自由的灵魂</h1>
    <button id="start-btn" class="enter-btn" onclick="startChat()">开启偶遇</button>
    <div id="chat-container">
        <div id="chat-box"><div id="status" style="color: #888; text-align: center; font-size: 0.8rem;">--- 正在连接云端 ---</div></div>
        <div id="input-area">
            <input type="text" id="msg-input" placeholder="输入感悟..." onkeydown="if(event.keyCode==13) sendMsg()">
            <button id="send-btn" class="btn" onclick="sendMsg()">发送</button>
            <button id="exit-btn" class="btn" onclick="exitChat()">离开</button>
        </div>
    </div>
    <div class="footer-text">自由是通向爱的大门</div>
    <script>
        const pubnub = new PubNub({
            publishKey: 'pub-c-48098c76-50d4-469b-8212-076f8e75294e',
            subscribeKey: 'sub-c-134e626e-4421-11eb-a5a4-325b0351f2f8',
            uuid: "Soul_" + Math.random().toString(36).substring(7)
        });
        function startChat() {
            document.getElementById('title').style.display = 'none';
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('chat-container').style.display = 'flex';
            pubnub.subscribe({ channels: ['soul_channel'] });
            setTimeout(() => { document.getElementById('status').innerText = "--- 已成功连接 ---"; }, 1000);
        }
        pubnub.addListener({
            message: function(event) {
                const box = document.getElementById('chat-box');
                const isMe = event.publisher === pubnub.getUUID();
                const div = document.createElement('div');
                div.style.margin = "10px 0";
                div.innerHTML = `<span style="color:${isMe?'#5f91ff':'#ff9f43'}; font-weight:bold;">${isMe?'我':'远方'}:</span> <span style="color:#eee;">${event.message.text}</span>`;
                box.appendChild(div);
                box.scrollTop = box.scrollHeight;
            }
        });
        function sendMsg() {
            const input = document.getElementById('msg-input');
            if (input.value.trim() !== "") {
                pubnub.publish({ channel: 'soul_channel', message: { text: input.value } });
                input.value = "";
            }
        }
        function exitChat() { if(confirm("确定离开吗？")) location.reload(); }
    </script>
</body>
</html>
