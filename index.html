<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>自由的灵魂 - 即时匹配</title>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.9.min.js"></script>
    <style>
        body { background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%); color: #ffffff; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: sans-serif; overflow: hidden; position: relative; }
        .night { position: absolute; width: 100%; height: 100%; transform: rotateZ(45deg); pointer-events: none; }
        .shooting_star { position: absolute; left: 50%; top: 50%; height: 2px; background: linear-gradient(-45deg, #5f91ff, rgba(0,0,255,0)); border-radius: 999px; animation: tail 3s ease-in-out infinite, shooting 3s ease-in-out infinite; }
        @keyframes tail { 0% { width: 0; } 30% { width: 100px; } 100% { width: 0; } }
        @keyframes shooting { 0% { transform: translateX(0); } 100% { transform: translateX(300px); } }
        
        #main-ui { text-align: center; z-index: 10; }
        h1 { font-weight: 200; letter-spacing: 4px; font-size: 1.5rem; }
        .enter-btn { padding: 15px 40px; background: white; color: black; border: none; cursor: pointer; border-radius: 30px; font-weight: bold; font-size: 1rem; }

        #chat-container { display: none; flex-direction: column; width: 92%; max-width: 500px; z-index: 20; height: 85vh; }
        #chat-box { width: 100%; flex: 1; background: rgba(255,255,255,0.08); overflow-y: auto; padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; backdrop-filter: blur(15px); box-sizing: border-box; }
        #input-area { width: 100%; display: flex; gap: 8px; }
        #msg-input { flex: 1; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 10px; font-size: 16px; outline: none; }
        .btn { padding: 10px 18px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div class="night"><div class="shooting_star"></div><div class="shooting_star"></div></div>

    <div id="main-ui">
        <h1>这里欢迎每一个渴望自由的灵魂</h1>
        <button class="enter-btn" onclick="startChat()">寻找缘分</button>
    </div>

    <div id="chat-container">
        <div id="chat-box">
            <div id="status" style="color: #5f91ff; text-align: center; font-size: 0.9rem; margin-bottom: 20px;">--- 已接入灵魂频道 ---</div>
        </div>
        <div id="input-area">
            <input type="text" id="msg-input" placeholder="输入你想说的..." onkeydown="if(event.keyCode==13) sendMsg()">
            <button id="send-btn" style="background: #5f91ff; color: white;" class="btn" onclick="sendMsg()">发送</button>
            <button style="background:rgba(255,255,255,0.1); color:#ccc" class="btn" onclick="location.reload()">离开</button>
        </div>
    </div>

    <script>
        const myChannel = "global_soul_match_v2"; // 简化逻辑，直接进入实时大厅
        const myID = "Soul_" + Math.random().toString(36).substring(7);

        const pubnub = new PubNub({
            publishKey: 'pub-c-48098c76-50d4-469b-8212-076f8e75294e',
            subscribeKey: 'sub-c-134e626e-4421-11eb-a5a4-325b0351f2f8',
            uuid: myID
        });

        function startChat() {
            document.getElementById('main-ui').style.display = 'none';
            document.getElementById('chat-container').style.display = 'flex';
            pubnub.subscribe({ channels: [myChannel] });
        }

        pubnub.addListener({
            message: function(event) {
                const box = document.getElementById('chat-box');
                const isMe = event.publisher === myID;
                const div = document.createElement('div');
                div.style.margin = "12px 0";
                div.style.textAlign = isMe ? "right" : "left";
                div.innerHTML = `<div style="display:inline-block; padding:8px 12px; border-radius:10px; background:${isMe?'#5f91ff':'rgba(255,255,255,0.1)'};">
                                    <small style="color:rgba(255,255,255,0.5); display:block; font-size:0.7rem;">${isMe?'我':'缘分'}</small>
                                    ${event.message.text}
                                 </div>`;
                box.appendChild(div);
                box.scrollTop = box.scrollHeight;
            }
        });

        function sendMsg() {
            const input = document.getElementById('msg-input');
            if (input.value.trim() !== "") {
                pubnub.publish({ channel: myChannel, message: { text: input.value } });
                input.value = "";
            }
        }
    </script>
</body>
</html>
